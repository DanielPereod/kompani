<div class="container">
  <h1>Library</h1>
  <form onsubmit="uploadBook(event)" enctype="multipart/form-data" class="upload-form">
    <label class="file-upload-label">
      <input type="file" name="file" accept="*" onchange="this.form.requestSubmit()">
      <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
        stroke-linejoin="round">
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
        <polyline points="17 8 12 3 7 8"></polyline>
        <line x1="12" y1="3" x2="12" y2="15"></line>
      </svg>
      <span>Upload New Book</span>
    </label>
    <div style="margin-left: auto; color: var(--text-secondary); font-size: 0.875rem;">
      Auto-upload enabled
    </div>
  </form>

  <div class="books-grid">
    {{#each books}}
    <div class="book-card">
      <img class="book-cover" src="/img/{{this}}" alt="{{this}}" loading="lazy">
      <div class="book-info">
        <h2 class="book-title">{{this}}</h2>
        <button class="delete-btn" onclick="deleteBook('{{this}}')">
          <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Delete
        </button>
      </div>
    </div>
    {{/each}}
  </div>
</div>
<script>
  function deleteBook(path) {
    fetch(`/book/${path}`, {
      method: 'DELETE',
    }).then(() => {
      window.location.reload();
    });
  }

  function uploadBook(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    fetch('/books/upload', {
      method: 'POST',
      body: formData,
    }).then(() => {
      window.location.reload();
    });
  }
</script>
